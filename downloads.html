<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Archive | WEEBOKAGE</title>
    <link rel="stylesheet" href="style.css">
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
</head>
<body>
    <nav>
        <div class="logo">PRIVATE ARCHIVE</div>
        <div class="links">
            <a href="index.html">View Site</a>
            <a href="#" onclick="logout()" style="color: var(--miku-pink);">Logout</a>
        </div>
    </nav>

    <div class="container">
        <!-- SECTION 1: BLOG POSTER -->
        <div class="card" style="border-top: 4px solid var(--miku-pink);">
            <h2 style="color: var(--miku-pink);">NEW BLOG POST</h2>
            <input type="text" id="postTitle" placeholder="Post Title">
            <input type="text" id="postImage" placeholder="Image URL (Direct link from Imgur/Discord/GitHub)">
            <textarea id="postContent" placeholder="Write your update here..." style="width:100%; height:120px; background:rgba(0,0,0,0.5); border:1px solid var(--miku-teal); color:white; border-radius:10px; padding:10px; margin:10px 0; font-family:inherit; resize: vertical;"></textarea>
            <button onclick="uploadPost()" id="postBtn" class="btn" style="width: 100%;">DEPLOY TO BLOG</button>
        </div>

        <!-- SECTION 2: DRIVE LINKS -->
        <h2 style="margin-top: 50px;">Secure Drive Links</h2>
        <div class="card">
            <h3>Google Drive Project A</h3>
            <p>Full folder access to my programs and images.</p>
            <a href="https://drive.google.com/drive/folders/1DM1uYFQu6jhLyNKlWEmmQVpzET3VNj_m?hl=de" target="_blank" class="btn">OPEN DRIVE</a>
        </div>

        <div class="card">
            <h3>Miku Background Pack</h3>
            <p>Collection of 4k wallpapers.</p>
            <a href="https://drive.google.com/drive/folders/1wrv-rG3Hw4bj0_9AmRyX8LO699XXHoLC?usp=sharing" target="_blank" class="btn">DOWNLOAD</a>
        </div>
    </div>

    <script>
        // 1. Initialize Firebase FIRST
        const firebaseConfig = {
            apiKey: "AIzaSyAj4pBH0zjbCIbUHp0ldmW8eU8pJTZnquo",
            authDomain: "weebokage-296c0.firebaseapp.com",
            projectId: "weebokage-296c0",
            storageBucket: "weebokage-296c0.firebasestorage.app",
            messagingSenderId: "192569800499",
            appId: "1:192569800499:web:4c5ef67242b7fdd0b2b046"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // 2. Security Check: If not logged in, redirect to login
        firebase.auth().onAuthStateChanged((user) => {
            if (!user) { window.location.href = "login.html"; }
        });

        // 3. Blog Upload Function
        function uploadPost() {
            const title = document.getElementById('postTitle').value;
            const image = document.getElementById('postImage').value;
            const content = document.getElementById('postContent').value;
            const btn = document.getElementById('postBtn');

            if(!title || !content) {
                alert("Please fill in the Title and Content!");
                return;
            }

            btn.innerText = "UPLOADING TO DATABASE...";
            btn.disabled = true;

            db.collection("posts").add({
                title: title,
                image: image,
                content: content,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            })
            .then(() => {
                alert("Success! Post is now live on the homepage.");
                // Clear the fields
                document.getElementById('postTitle').value = "";
                document.getElementById('postImage').value = "";
                document.getElementById('postContent').value = "";
                btn.innerText = "DEPLOY TO BLOG";
                btn.disabled = false;
            })
            .catch((error) => {
                console.error("Error adding document: ", error);
                alert("Error: " + error.message);
                btn.innerText = "DEPLOY TO BLOG";
                btn.disabled = false;
            });
        }

        function logout() {
            firebase.auth().signOut().then(() => { window.location.href = "index.html"; });
        }
    </script>
</body>
</html>
