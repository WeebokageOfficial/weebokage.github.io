<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Archive | WEEBOKAGE</title>
    <link rel="stylesheet" href="style.css?v=1.4">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
</head>
<body>
    <nav>
        <div class="links">
            <a href="index.html">View Site</a>
            <a href="javascript:void(0)" onclick="logout()" style="color: var(--primary); font-weight: bold;">Logout</a>
        </div>
    </nav>

    <div class="container">
        <!-- POST EDITOR -->
        <div class="card" style="border-top: 5px solid var(--primary);">
            <h2 style="color: var(--primary);">NEW BLOG POST</h2>
            <input type="text" id="postTitle" placeholder="Title" style="width:100%; padding:10px; margin-bottom:10px; background:rgba(0,0,0,0.3); border:1px solid var(--primary); color:white; border-radius:5px;">
            <input type="text" id="postImage" placeholder="Image URL" style="width:100%; padding:10px; margin-bottom:10px; background:rgba(0,0,0,0.3); border:1px solid var(--primary); color:white; border-radius:5px;">
            <textarea id="postContent" placeholder="Content" style="width:100%; height:100px; padding:10px; background:rgba(0,0,0,0.3); border:1px solid var(--primary); color:white; border-radius:5px; resize:none;"></textarea>
            <button onclick="uploadPost()" class="btn" style="width:100%; margin-top:10px;">DEPLOY TO BLOG</button>
        </div>

        <!-- COMMENT MANAGEMENT -->
        <h2 style="color: var(--primary); margin-top: 50px;">COMMENT MODERATION</h2>
        <div id="admin-comments"></div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAj4pBH0zjbCIbUHp0ldmW8eU8pJTZnquo",
            authDomain: "weebokage-296c0.firebaseapp.com",
            projectId: "weebokage-296c0",
            storageBucket: "weebokage-296c0.firebasestorage.app",
            messagingSenderId: "192569800499",
            appId: "1:192569800499:web:4c5ef67242b7fdd0b2b046"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        firebase.auth().onAuthStateChanged((user) => { if (!user) window.location.replace("login.html"); });

        function logout() { firebase.auth().signOut().then(() => window.location.replace("index.html")); }

        function uploadPost() {
            const title = document.getElementById('postTitle').value;
            const content = document.getElementById('postContent').value;
            const img = document.getElementById('postImage').value;
            db.collection("posts").add({ title, content, image: img, timestamp: firebase.firestore.FieldValue.serverTimestamp() })
            .then(() => alert("Post Published!"));
        }

        db.collection("comments").orderBy("timestamp", "desc").onSnapshot((snaps) => {
            const div = document.getElementById('admin-comments');
            div.innerHTML = "";
            snaps.forEach((doc) => {
                const c = doc.data();
                div.innerHTML += `<div class="card" style="display:flex; justify-content:space-between; align-items:center; padding:15px;"><div><strong>${c.name}:</strong> ${c.msg}</div><button onclick="deleteComment('${doc.id}')" style="background:#ff2d55; color:white; border:none; padding:5px 10px; border-radius:5px; cursor:pointer;">DEL</button></div>`;
            });
        });

        function deleteComment(id) { if(confirm("Delete?")) db.collection("comments").doc(id).delete(); }
    </script>
</body>
</html>
