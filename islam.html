<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Islam | WEEBOKAGE</title>
    <link rel="stylesheet" href="style.css?v=7.0">
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    
    <!-- Firebase SDKs (Required for the login check) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

    <style>
        .islam-body { background: #fdfcf0 !important; color: #1a2f23 !important; background-image: none !important; }
        .islam-card { background: white !important; border: 2px solid #d4af37 !important; color: #1a2f23 !important; padding: 30px !important; box-shadow: 0 10px 30px rgba(0,0,0,0.05) !important; }
        .arabic { font-family: 'Amiri', serif; font-size: 1.8rem; text-align: right; direction: rtl; color: #064e3b; line-height: 1.8; }
        .hadith-badge { display: inline-block; background: #064e3b; color: #d4af37; padding: 5px 15px; border-radius: 5px; font-weight: bold; margin-top: 20px; font-size: 0.8rem; }
        .prayer-row { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #f0f0f0; }
        .islam-nav { background: #064e3b !important; border-bottom: 4px solid #d4af37 !important; display: flex; justify-content: center; padding: 15px; }
        .islam-nav a { color: white !important; text-decoration: none; margin: 0 10px; font-weight: bold; font-size: 0.8rem; text-transform: uppercase; }
    </style>
</head>
<body class="islam-body">
    <nav class="islam-nav">
        <div class="links">
            <a href="index.html">Home</a>
            <a href="islam.html">Islam</a>
            <a href="downloads.html">Admin</a>
        </div>
    </nav>
    <div class="container">
        <h1 style="text-align:center; color:#064e3b; font-family:'Amiri'; font-size:2.5rem; margin:30px 0;">بِسْمِ اللهِ الرَّحْمٰنِ الرَّحِيْمِ</h1>
        
        <div class="card islam-card">
            <h2 style="color:#064e3b !important; border-bottom:1px solid #d4af37; padding-bottom:10px; margin-bottom:20px; font-size: 1.2rem;">
                <i class="fas fa-book"></i> Sahih al-Bukhari
            </h2>
            <div id="hadith-box">Connecting to authentic transmission...</div>
            <div id="hadith-footer" style="text-align: right; margin-top: 15px;">
                <span id="h-num-badge" class="hadith-badge">Bukhari Archive</span>
            </div>
            <button class="btn" onclick="fetchHadith()" style="background:#064e3b; color:white; width: 100%; margin-top:20px;">RANDOMIZE</button>
        </div>

        <div class="card islam-card">
            <h2 style="color:#064e3b !important; border-bottom:1px solid #d4af37; padding-bottom:10px; margin-bottom:20px; font-size: 1.2rem;">
                <i class="fas fa-clock"></i> Mawaqit al-Salat
            </h2>
            <div id="hijri-display" style="text-align: center; font-weight: bold; margin-bottom: 10px; color: #064e3b;">...</div>
            <div id="prayer-list">Loading times...</div>
        </div>
    </div>

    <script>
        // --- 1. FIREBASE CONFIG ---
        const firebaseConfig = { apiKey: "AIzaSyAj4pBH0zjbCIbUHp0ldmW8eU8pJTZnquo", authDomain: "weebokage-296c0.firebaseapp.com", projectId: "weebokage-296c0", storageBucket: "weebokage-296c0.firebasestorage.app", messagingSenderId: "192569800499", appId: "1:192569800499:web:4c5ef67242b7fdd0b2b046" };
        firebase.initializeApp(firebaseConfig);

        // --- 2. PROTECTION: Boot if not logged in ---
        firebase.auth().onAuthStateChanged(user => {
            if (!user) window.location.replace("index.html");
        });

        // --- 3. HADITH ENGINE (Phone Optimized) ---
        const API_KEY = "$2y$10$bh8gWRHGMPAOaerOv4kXpOQLdNdrE1DR7lBNK9oL7OuE20QHSIM6";
        
        async function fetchHadith() {
            const box = document.getElementById('hadith-box');
            const badge = document.getElementById('h-num-badge');
            box.innerHTML = "<small>Synchronizing...</small>";
            
            try {
                const page = Math.floor(Math.random() * 100) + 1;
                // Force HTTPS
                const res = await fetch(`https://hadithapi.com/api/hadiths?apiKey=${API_KEY}&book=sahih-bukhari&paginate=10&page=${page}`);
                const json = await res.json();
                const h = json.hadiths.data[Math.floor(Math.random() * json.hadiths.data.length)];
                
                let cleanedEn = h.hadithEnglish.replace(/[\u0600-\u06FF]+/g, "").replace(/\s+/g, " ").trim();
                
                box.innerHTML = `<p class="arabic">${h.hadithArabic}</p><p style="margin-top:20px; line-height:1.6; font-size: 0.95rem;">${cleanedEn}</p>`;
                badge.innerText = `Bukhari | No. ${h.hadithNumber}`;
            } catch (e) { 
                box.innerHTML = "Archive currently busy. Tap Randomize to retry."; 
            }
        }

        // --- 4. PRAYER TIMES ENGINE (with Fallback for Phones) ---
        function loadPrayers() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (pos) => getPrayerData(pos.coords.latitude, pos.coords.longitude),
                    () => getPrayerData(21.4225, 39.8262) // Fallback to Makkah if phone location is off
                );
            } else {
                getPrayerData(21.4225, 39.8262);
            }
        }

        async function getPrayerData(lat, lon) {
            try {
                // Force HTTPS
                const res = await fetch(`https://api.aladhan.com/v1/timings?latitude=${lat}&longitude=${lon}&method=3`);
                const data = await res.json();
                const t = data.data.timings;
                
                document.getElementById('hijri-display').innerText = `${data.data.date.hijri.day} ${data.data.date.hijri.month.en} ${data.data.date.hijri.year} AH`;
                
                const prayers = ["Fajr", "Dhuhr", "Asr", "Maghrib", "Isha"];
                document.getElementById('prayer-list').innerHTML = prayers.map(n => `
                    <div class="prayer-row">
                        <strong>${n}</strong><span style="color:#d4af37;">${t[n]}</span>
                    </div>`).join('');
            } catch (e) {
                document.getElementById('prayer-list').innerText = "Network Error on Phone.";
            }
        }

        fetchHadith(); loadPrayers();
    </script>
</body>
</html>
